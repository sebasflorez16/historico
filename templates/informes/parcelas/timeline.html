{% extends "informes/base.html" %}
{% load static %}

{% block title %}üé¨ Timeline Visual - {{ parcela.nombre }}{% endblock %}

{% block extra_css %}
<!-- üöÄ FASE 2: Estilos de m√≥dulos avanzados -->
<link rel="stylesheet" href="{% static 'css/timeline_modules.css' %}">
<style>
    /* ========================================
       üé¨ TIMELINE VISUAL - ESTILOS
       ======================================== */
    
    :root {
        --timeline-primary: var(--agrotech-green);
        --timeline-secondary: var(--agrotech-orange);
        --timeline-bg: var(--neuro-bg-primary);
        --timeline-card-bg: var(--neuro-bg-secondary);
    }
    
    .timeline-container {
        background: var(--timeline-card-bg);
        border-radius: 32px;
        padding: 40px;
        box-shadow: var(--neuro-shadow-light), var(--neuro-shadow-dark);
        margin-bottom: 30px;
    }
    
    .timeline-header {
        text-align: center;
        margin-bottom: 40px;
        position: relative;
    }
    
    .timeline-header::after {
        content: '';
        position: absolute;
        bottom: -20px;
        left: 50%;
        transform: translateX(-50%);
        width: 100px;
        height: 4px;
        background: linear-gradient(90deg, var(--timeline-primary), var(--timeline-secondary));
        border-radius: 2px;
    }
    
    .timeline-header h1 {
        font-size: 2.5rem;
        font-weight: 800;
        color: var(--timeline-primary);
        margin-bottom: 10px;
    }
    
    .timeline-header .subtitle {
        color: #6c757d;
        font-size: 1.1rem;
        font-weight: 600;
    }
    
    /* Canvas de visualizaci√≥n - Responsive mejorado */
    .canvas-wrapper {
        position: relative;
        width: 100%;
        max-width: 1200px;
        margin: 0 auto;
        aspect-ratio: 16 / 9; /* Ratio consistente */
        background: #000;
        border-radius: 20px;
        overflow: hidden;
        box-shadow: var(--neuro-shadow-light), var(--neuro-shadow-dark);
    }
    
    .canvas-wrapper:hover {
        box-shadow: var(--neuro-shadow-hover-light), var(--neuro-shadow-hover-dark);
    }
    
    #timeline-canvas {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        display: block;
        cursor: crosshair;
    }
    
    /* Tooltip mejorado */
    #canvas-tooltip {
        transition: opacity 0.2s ease;
    }
    
    /* Leyenda de colores */
    .color-legend strong {
        display: block;
        font-size: 0.9rem;
    }
    
    .color-legend .row > div {
        transition: transform 0.2s ease;
    }
    
    .color-legend .row > div:hover {
        transform: translateY(-3px);
    }
    
    /* Panel de metadata */
    .metadata-panel {
        background: linear-gradient(145deg, rgba(46, 139, 87, 0.08), rgba(255, 122, 0, 0.08));
        border-radius: 20px;
        padding: 25px;
        margin-top: 25px;
        box-shadow: inset -2px -2px 5px rgba(255, 255, 255, 0.7),
                    inset 2px 2px 5px rgba(46, 139, 87, 0.1);
    }
    
    .metadata-item {
        display: flex;
        align-items: center;
        gap: 15px;
        padding: 15px;
        background: var(--timeline-bg);
        border-radius: 12px;
        margin-bottom: 12px;
        box-shadow: var(--neuro-shadow-light), var(--neuro-shadow-dark);
        transition: transform 0.2s ease;
    }
    
    .metadata-item:hover {
        transform: translateX(5px);
    }
    
    .metadata-icon {
        font-size: 2rem;
        width: 50px;
        height: 50px;
        display: flex;
        align-items: center;
        justify-content: center;
        background: var(--timeline-card-bg);
        border-radius: 12px;
        box-shadow: var(--neuro-shadow-light), var(--neuro-shadow-dark);
    }
    
    .metadata-content {
        flex: 1;
    }
    
    .metadata-label {
        font-size: 0.85rem;
        color: #6c757d;
        font-weight: 600;
        text-transform: uppercase;
        letter-spacing: 0.5px;
        margin-bottom: 5px;
    }
    
    .metadata-value {
        font-size: 1.3rem;
        font-weight: 800;
        color: var(--timeline-primary);
    }
    
    /* Controles de reproducci√≥n */
    .timeline-controls {
        display: flex;
        flex-wrap: wrap;
        gap: 15px;
        align-items: center;
        justify-content: center;
        padding: 25px;
        background: var(--timeline-card-bg);
        border-radius: 20px;
        margin-top: 25px;
        box-shadow: var(--neuro-shadow-light), var(--neuro-shadow-dark);
    }
    
    .control-btn {
        width: 60px;
        height: 60px;
        border-radius: 50%;
        border: none;
        background: var(--timeline-bg);
        box-shadow: var(--neuro-shadow-light), var(--neuro-shadow-dark);
        color: var(--timeline-primary);
        font-size: 1.5rem;
        cursor: pointer;
        transition: all 0.3s ease;
        display: flex;
        align-items: center;
        justify-content: center;
    }
    
    .control-btn:hover {
        transform: scale(1.1);
        box-shadow: var(--neuro-shadow-hover-light), var(--neuro-shadow-hover-dark);
    }
    
    .control-btn:active {
        transform: scale(0.95);
        box-shadow: inset -2px -2px 5px rgba(255, 255, 255, 0.7),
                    inset 2px 2px 5px rgba(46, 139, 87, 0.1);
    }
    
    .control-btn.play-btn {
        width: 80px;
        height: 80px;
        font-size: 2rem;
        background: var(--timeline-primary);
        color: white;
    }
    
    /* Slider temporal */
    .timeline-slider-container {
        flex: 1;
        min-width: 300px;
        padding: 0 20px;
    }
    
    .timeline-slider {
        width: 100%;
        height: 12px;
        border-radius: 10px;
        background: var(--timeline-bg);
        box-shadow: inset -2px -2px 5px rgba(255, 255, 255, 0.7),
                    inset 2px 2px 5px rgba(46, 139, 87, 0.1);
        outline: none;
        -webkit-appearance: none;
        appearance: none;
    }
    
    .timeline-slider::-webkit-slider-thumb {
        -webkit-appearance: none;
        appearance: none;
        width: 24px;
        height: 24px;
        border-radius: 50%;
        background: var(--timeline-secondary);
        cursor: pointer;
        box-shadow: 0 2px 8px rgba(255, 122, 0, 0.4);
        transition: all 0.2s ease;
    }
    
    .timeline-slider::-webkit-slider-thumb:hover {
        transform: scale(1.2);
        box-shadow: 0 4px 12px rgba(255, 122, 0, 0.6);
    }
    
    .timeline-slider::-moz-range-thumb {
        width: 24px;
        height: 24px;
        border-radius: 50%;
        background: var(--timeline-secondary);
        cursor: pointer;
        border: none;
        box-shadow: 0 2px 8px rgba(255, 122, 0, 0.4);
    }
    
    /* Selector de √≠ndice */
    .index-selector {
        display: flex;
        gap: 10px;
        margin-top: 20px;
        justify-content: center;
    }
    
    .index-btn {
        padding: 12px 24px;
        border-radius: 12px;
        border: none;
        background: var(--timeline-bg);
        box-shadow: var(--neuro-shadow-light), var(--neuro-shadow-dark);
        color: #6c757d;
        font-weight: 700;
        cursor: pointer;
        transition: all 0.3s ease;
    }
    
    .index-btn.active {
        background: var(--timeline-primary);
        color: white;
        box-shadow: 0 4px 12px rgba(46, 139, 87, 0.4);
        transform: translateY(-2px);
    }
    
    .index-btn:hover:not(.active) {
        transform: translateY(-2px);
        box-shadow: var(--neuro-shadow-hover-light), var(--neuro-shadow-hover-dark);
    }
    
    /* Contador de frames */
    .frame-counter {
        padding: 12px 24px;
        background: var(--timeline-bg);
        border-radius: 12px;
        box-shadow: var(--neuro-shadow-light), var(--neuro-shadow-dark);
        font-weight: 800;
        color: var(--timeline-primary);
        min-width: 120px;
        text-align: center;
    }
    
    /* Loading spinner */
    .loading-overlay {
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: rgba(0, 0, 0, 0.7);
        display: flex;
        align-items: center;
        justify-content: center;
        border-radius: 20px;
        z-index: 1000;
    }
    
    .spinner {
        width: 60px;
        height: 60px;
        border: 6px solid rgba(255, 255, 255, 0.3);
        border-top-color: var(--timeline-primary);
        border-radius: 50%;
        animation: spin 1s linear infinite;
    }
    
    @keyframes spin {
        to { transform: rotate(360deg); }
    }
    
    /* üì± Responsive - OPTIMIZADO para m√≥vil */
    @media (max-width: 768px) {
        .timeline-container {
            padding: 15px;
            border-radius: 20px;
        }
        
        .timeline-header h1 {
            font-size: 1.5rem;
        }
        
        .timeline-header .subtitle {
            font-size: 0.95rem;
        }
        
        .canvas-wrapper {
            aspect-ratio: 4 / 3; /* Ratio m√°s cuadrado en m√≥vil */
            border-radius: 12px;
        }
        
        /* üî• Controles en FILA horizontal (no vertical) */
        .timeline-controls {
            padding: 15px 10px;
            gap: 10px;
            flex-direction: row; /* Horizontal para mejor UX */
            flex-wrap: wrap; /* Permitir wrap si es necesario */
            justify-content: space-between;
        }
        
        /* üî• Botones de control m√°s peque√±os pero t√°ctiles */
        .control-btn {
            width: 48px;
            height: 48px;
            font-size: 1.2rem;
        }
        
        .control-btn.play-btn {
            width: 60px;
            height: 60px;
            font-size: 1.8rem;
        }
        
        /* üî• Slider en su propia fila, m√°s ancho */
        .timeline-slider-container {
            width: 100%;
            min-width: 100%;
            padding: 0 5px;
            order: 2; /* Despu√©s de los botones */
            margin-top: 10px;
        }
        
        /* üî• Contador de frames visible pero compacto */
        .frame-counter {
            font-size: 0.85rem;
            padding: 10px 15px;
            min-width: 90px;
            order: 1;
        }
        
        /* üî• Metadata en grid de 2 columnas */
        .metadata-panel {
            padding: 15px 10px;
            margin-top: 15px;
        }
        
        .metadata-panel .row {
            display: grid !important;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
        }
        
        .metadata-item {
            padding: 10px;
            margin-bottom: 0;
            flex-direction: row; /* Horizontal, no vertical */
            text-align: left;
            gap: 10px;
        }
        
        .metadata-icon {
            width: 40px;
            height: 40px;
            font-size: 1.5rem;
            flex-shrink: 0;
        }
        
        .metadata-label {
            font-size: 0.7rem;
        }
        
        .metadata-value {
            font-size: 1.1rem;
        }
        
        /* üî• Selector de √≠ndices en 3 botones horizontales */
        .index-selector {
            flex-wrap: nowrap;
            gap: 8px;
            justify-content: stretch;
        }
        
        .index-btn {
            padding: 12px 10px;
            font-size: 0.85rem;
            flex: 1;
            min-width: 0; /* Permitir que se reduzcan equitativamente */
        }
        
        /* üî• Leyenda de colores en grid 3x2 */
        .color-legend .row {
            display: grid !important;
            grid-template-columns: repeat(3, 1fr);
            gap: 8px;
        }
        
        .color-legend .row > div {
            flex: none;
            max-width: none;
            margin-bottom: 0;
        }
        
        .color-legend strong {
            font-size: 0.75rem;
        }
        
        /* üî• Tooltip m√°s peque√±o pero legible */
        #canvas-tooltip {
            max-width: 280px;
            font-size: 0.8rem;
            padding: 10px;
        }
        
        /* Gu√≠a de atajos m√°s compacta */
        .keyboard-shortcuts {
            font-size: 0.75rem;
            padding: 10px;
        }
        
        .keyboard-shortcuts kbd {
            font-size: 0.7rem;
            padding: 3px 6px;
        }
    }
    
    /* üì± Extra small devices (< 480px) */
    @media (max-width: 480px) {
        .timeline-container {
            padding: 10px;
            border-radius: 16px;
        }
        
        .timeline-header h1 {
            font-size: 1.2rem;
        }
        
        .timeline-header .subtitle {
            font-size: 0.85rem;
        }
        
        .canvas-wrapper {
            aspect-ratio: 1 / 1; /* Ratio cuadrado en m√≥viles muy peque√±os */
            border-radius: 10px;
        }
        
        /* üî• Botones a√∫n m√°s peque√±os pero t√°ctiles (48px m√≠nimo recomendado) */
        .control-btn {
            width: 44px;
            height: 44px;
            font-size: 1rem;
        }
        
        .control-btn.play-btn {
            width: 56px;
            height: 56px;
            font-size: 1.5rem;
        }
        
        /* üî• √çndices compactos pero legibles */
        .index-btn {
            font-size: 0.75rem;
            padding: 10px 8px;
        }
        
        /* üî• Metadata en 1 columna */
        .metadata-panel .row {
            grid-template-columns: 1fr !important;
        }
        
        /* üî• Leyenda en 2 columnas (no 1) para aprovechar espacio */
        .color-legend .row {
            grid-template-columns: repeat(2, 1fr) !important;
        }
        
        /* Tooltip m√°s peque√±o */
        #canvas-tooltip {
            max-width: 220px;
            font-size: 0.75rem;
            padding: 8px;
        }
        
        .frame-counter {
            font-size: 0.8rem;
            padding: 8px 12px;
            min-width: 80px;
        }
    }
</style>
{% endblock %}

{% block content %}
<div class="container-fluid px-4">
    <!-- Bot√≥n volver -->
    <div class="mb-4">
        <a href="{% url 'informes:detalle_parcela' parcela.id %}" class="btn btn-light" style="border-radius: 12px;">
            <i class="fas fa-arrow-left me-2"></i>Volver a Detalle
        </a>
    </div>
    
    <!-- Timeline Container -->
    <div class="timeline-container">
        <!-- Header -->
        <div class="timeline-header">
            <h1><i class="fas fa-film me-3"></i>Timeline Visual</h1>
            <p class="subtitle">{{ parcela.nombre }} - Evoluci√≥n Temporal</p>
        </div>
        
        <!-- Canvas de visualizaci√≥n -->
        <div class="canvas-wrapper">
            <canvas id="timeline-canvas"></canvas>
            
            <!-- Loading overlay mejorado con progreso -->
            <div id="loading-overlay" class="loading-overlay" style="display: none;">
                <div style="text-align: center; color: white;">
                    <div class="spinner"></div>
                    <p id="loading-text" style="margin-top: 20px; font-size: 1.1rem; font-weight: 600;">
                        Cargando timeline...
                    </p>
                    <div style="width: 300px; height: 8px; background: rgba(255,255,255,0.2); border-radius: 10px; margin: 15px auto; overflow: hidden;">
                        <div id="loading-progress" style="width: 0%; height: 100%; background: var(--timeline-primary); border-radius: 10px; transition: width 0.3s ease;"></div>
                    </div>
                    <p id="loading-percentage" style="font-size: 0.9rem; opacity: 0.8;">0%</p>
                </div>
            </div>
            
            <!-- Tooltip para hover -->
            <div id="canvas-tooltip" style="
                position: absolute;
                display: none;
                background: rgba(0, 0, 0, 0.9);
                color: white;
                padding: 12px 16px;
                border-radius: 8px;
                font-size: 0.9rem;
                pointer-events: none;
                z-index: 1001;
                box-shadow: 0 4px 12px rgba(0,0,0,0.5);
                max-width: 250px;
            "></div>
        </div>
        
        <!-- Leyenda de colores interpretativa -->
        <div class="color-legend" style="
            margin-top: 20px;
            padding: 20px;
            background: var(--timeline-card-bg);
            border-radius: 16px;
            box-shadow: var(--neuro-shadow-light), var(--neuro-shadow-dark);
        ">
            <h5 style="text-align: center; color: var(--timeline-primary); margin-bottom: 15px; font-weight: 700;">
                <i class="fas fa-palette me-2"></i>Interpretaci√≥n de Colores
            </h5>
            <div class="row text-center">
                <div class="col-6 col-md-3 mb-3">
                    <div style="background: #8B0000; height: 30px; border-radius: 8px; margin-bottom: 8px;"></div>
                    <strong style="color: #8B0000;">Muy Bajo</strong>
                    <p style="font-size: 0.8rem; color: #6c757d; margin: 0;">< 0.2</p>
                    <small style="font-size: 0.75rem; color: #999;">Suelo/Agua</small>
                </div>
                <div class="col-6 col-md-3 mb-3">
                    <div style="background: #FFD700; height: 30px; border-radius: 8px; margin-bottom: 8px;"></div>
                    <strong style="color: #B8860B;">Bajo</strong>
                    <p style="font-size: 0.8rem; color: #6c757d; margin: 0;">0.2 - 0.4</p>
                    <small style="font-size: 0.75rem; color: #999;">Vegetaci√≥n d√©bil</small>
                </div>
                <div class="col-6 col-md-3 mb-3">
                    <div style="background: #ADFF2F; height: 30px; border-radius: 8px; margin-bottom: 8px;"></div>
                    <strong style="color: #6B8E23;">Moderado</strong>
                    <p style="font-size: 0.8rem; color: #6c757d; margin: 0;">0.4 - 0.6</p>
                    <small style="font-size: 0.75rem; color: #999;">Saludable</small>
                </div>
                <div class="col-6 col-md-3 mb-3">
                    <div style="background: #006400; height: 30px; border-radius: 8px; margin-bottom: 8px;"></div>
                    <strong style="color: #006400;">Alto</strong>
                    <p style="font-size: 0.8rem; color: #6c757d; margin: 0;">0.6 - 1.0</p>
                    <small style="font-size: 0.75rem; color: #999;">√ìptimo</small>
                </div>
            </div>
        </div>
        
        <!-- Panel de Metadata -->
        <div class="metadata-panel" id="metadata-panel">
            <div class="row">
                <div class="col-lg-3 col-md-4 col-6 mb-3">
                    <div class="metadata-item">
                        <div class="metadata-icon" id="icon-periodo">üìÖ</div>
                        <div class="metadata-content">
                            <div class="metadata-label">Per√≠odo</div>
                            <div class="metadata-value" id="value-periodo">-</div>
                        </div>
                    </div>
                </div>
                <div class="col-lg-3 col-md-4 col-6 mb-3">
                    <div class="metadata-item">
                        <div class="metadata-icon" id="icon-indice">üåø</div>
                        <div class="metadata-content">
                            <div class="metadata-label">√çndice</div>
                            <div class="metadata-value" id="value-indice">-</div>
                        </div>
                    </div>
                </div>
                <div class="col-lg-3 col-md-4 col-6 mb-3">
                    <div class="metadata-item">
                        <div class="metadata-icon" id="icon-tendencia">üìà</div>
                        <div class="metadata-content">
                            <div class="metadata-label">Cambio vs Anterior</div>
                            <div class="metadata-value" id="value-tendencia">-</div>
                        </div>
                    </div>
                </div>
                <div class="col-lg-3 col-md-4 col-6 mb-3">
                    <div class="metadata-item">
                        <div class="metadata-icon" id="icon-calidad">‚≠ê</div>
                        <div class="metadata-content">
                            <div class="metadata-label">Calidad Imagen</div>
                            <div class="metadata-value" id="value-calidad">-</div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Resumen simple -->
            <div class="mt-3 text-center">
                <p id="resumen-simple" style="font-size: 1.1rem; font-weight: 600; color: #2c3e50; margin: 0;">
                    Cargando datos...
                </p>
            </div>
        </div>
        
        <!-- Selector de √çndice -->
        <div class="index-selector">
            <button class="index-btn active" data-index="ndvi">
                <i class="fas fa-leaf me-2"></i>NDVI
            </button>
            <button class="index-btn" data-index="ndmi">
                <i class="fas fa-tint me-2"></i>NDMI
            </button>
            <button class="index-btn" data-index="savi">
                <i class="fas fa-seedling me-2"></i>SAVI
            </button>
        </div>
        
        <!-- Botones de Descarga de Video -->
        <div class="download-controls mt-3" style="text-align: center;">
            <h5 style="color: var(--timeline-primary); margin-bottom: 15px;">
                <i class="fas fa-download me-2"></i>Descargar Timeline como Video
            </h5>
            <div class="d-flex justify-content-center gap-3 flex-wrap">
                <button class="btn btn-success" id="btn-download-ndvi" style="border-radius: 12px; padding: 12px 24px; font-weight: 700;">
                    <i class="fas fa-leaf me-2"></i>Descargar NDVI
                </button>
                <button class="btn btn-info" id="btn-download-ndmi" style="border-radius: 12px; padding: 12px 24px; font-weight: 700;">
                    <i class="fas fa-tint me-2"></i>Descargar NDMI
                </button>
                <button class="btn btn-warning" id="btn-download-savi" style="border-radius: 12px; padding: 12px 24px; font-weight: 700;">
                    <i class="fas fa-seedling me-2"></i>Descargar SAVI
                </button>
            </div>
            <p class="text-muted mt-2" style="font-size: 0.9rem;">
                <i class="fas fa-info-circle me-1"></i>
                Los videos se generan con calidad HD (1200x600px) a 2 FPS
            </p>
        </div>
        
        <!-- Controles de Reproducci√≥n -->
        <div class="timeline-controls">
            <button class="control-btn" id="btn-first" title="Primer frame (Home)">
                <i class="fas fa-step-backward"></i>
            </button>
            <button class="control-btn" id="btn-prev" title="Frame anterior (‚Üê)">
                <i class="fas fa-chevron-left"></i>
            </button>
            <button class="control-btn play-btn" id="btn-play" title="Reproducir (Espacio)">
                <i class="fas fa-play"></i>
            </button>
            <button class="control-btn" id="btn-next" title="Frame siguiente (‚Üí)">
                <i class="fas fa-chevron-right"></i>
            </button>
            <button class="control-btn" id="btn-last" title="√öltimo frame (End)">
                <i class="fas fa-step-forward"></i>
            </button>
            
            <div class="timeline-slider-container">
                <input type="range" id="timeline-slider" class="timeline-slider" 
                       min="0" max="0" value="0">
            </div>
            
            <div class="frame-counter" id="frame-counter">
                0 / 0
            </div>
        </div>
        
        <!-- üÜï Ayuda de atajos de teclado -->
        <div class="keyboard-shortcuts" style="
            margin-top: 15px;
            padding: 15px 20px;
            background: linear-gradient(145deg, rgba(46, 139, 87, 0.05), rgba(255, 122, 0, 0.05));
            border-radius: 12px;
            text-align: center;
        ">
            <p style="margin: 0; font-size: 0.85rem; color: #6c757d;">
                <i class="fas fa-keyboard me-2"></i><strong>Atajos:</strong>
                <kbd style="background: var(--timeline-bg); padding: 4px 8px; border-radius: 4px; margin: 0 3px; font-family: monospace;">Espacio</kbd> Play/Pause |
                <kbd style="background: var(--timeline-bg); padding: 4px 8px; border-radius: 4px; margin: 0 3px; font-family: monospace;">‚Üê‚Üí</kbd> Navegar |
                <kbd style="background: var(--timeline-bg); padding: 4px 8px; border-radius: 4px; margin: 0 3px; font-family: monospace;">‚Üë‚Üì</kbd> Cambiar √≠ndice |
                <kbd style="background: var(--timeline-bg); padding: 4px 8px; border-radius: 4px; margin: 0 3px; font-family: monospace;">1-2-3</kbd> NDVI/NDMI/SAVI
            </p>
        </div>
    </div>
</div>

<!-- Datos para JavaScript -->
<script id="timeline-config" type="application/json">
{
    "parcela_id": {{ parcela.id }},
    "parcela_nombre": "{{ parcela.nombre|escapejs }}",
    "api_url": "{% url 'informes:timeline_api' parcela.id %}",
    "total_frames": {{ total_frames|default:0 }},
    "rango_datos": {{ rango_datos_json|safe }}
}
</script>
{% endblock %}

{% block extra_js %}
<!-- üöÄ FASE 2: M√≥dulos avanzados del Timeline Player -->
<script src="{% static 'js/timeline/modules/playback_controller.js' %}"></script>
<script src="{% static 'js/timeline/modules/transition_engine.js' %}"></script>
<script src="{% static 'js/timeline/modules/filter_engine.js' %}"></script>

<!-- Timeline Player principal -->
<script src="{% static 'js/timeline/timeline_player.js' %}"></script>
<script>
// Inicializar Timeline Player cuando el DOM est√© listo
document.addEventListener('DOMContentLoaded', function() {
    const config = JSON.parse(document.getElementById('timeline-config').textContent);
    
    // Crear instancia del player
    const player = new TimelinePlayer({
        canvasId: 'timeline-canvas',
        apiUrl: config.api_url,
        parcelaId: config.parcela_id,
        parcelaNombre: config.parcela_nombre
    });
    
    // Inicializar
    player.init();
});
</script>
{% endblock %}
