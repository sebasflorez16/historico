{% extends 'informes/base_public.html' %}
{% load static %}

{% block title %}Confirmar Registro - AgroTech Histórico{% endblock %}

{% block extra_css %}
<style>
    .confirmacion-container {
        padding: 40px 0;
        min-height: 80vh;
    }
    
    .confirmacion-card {
        border: none;
        border-radius: 16px;
        box-shadow: 0 10px 30px rgba(0,0,0,0.1);
        overflow: hidden;
        max-width: 800px;
        margin: 0 auto;
    }
    
    .card-header {
        background: linear-gradient(135deg, #ff9800, #f57c00);
        color: white;
        padding: 30px;
        text-align: center;
    }
    
    .card-header i {
        font-size: 60px;
        margin-bottom: 15px;
    }
    
    .info-section {
        background: #fff3e0;
        border-left: 4px solid #ff9800;
        padding: 20px;
        margin: 20px 0;
        border-radius: 8px;
    }
    
    .dato-confirmacion {
        display: flex;
        justify-content: space-between;
        padding: 12px 0;
        border-bottom: 1px solid #e0e0e0;
    }
    
    .dato-confirmacion:last-child {
        border-bottom: none;
    }
    
    .dato-label {
        font-weight: 600;
        color: #555;
    }
    
    .dato-value {
        color: #333;
        font-weight: 500;
    }
    
    .area-destacada {
        background: #e8f5e9;
        padding: 20px;
        border-radius: 12px;
        text-align: center;
        margin: 20px 0;
    }
    
    .area-destacada .numero {
        font-size: 48px;
        font-weight: 700;
        color: #2e7d32;
        display: block;
    }
    
    .area-destacada .label {
        font-size: 18px;
        color: #555;
        margin-top: 10px;
    }
    
    .advertencia-box {
        background: #fff3e0;
        border: 2px solid #ff9800;
        padding: 20px;
        border-radius: 12px;
        margin: 30px 0;
    }
    
    .advertencia-box h5 {
        color: #f57c00;
        margin-bottom: 15px;
    }
    
    .advertencia-box ul {
        margin-bottom: 0;
        padding-left: 25px;
    }
    
    .advertencia-box li {
        margin-bottom: 8px;
        color: #666;
    }
    
    .btn-confirmar {
        background: linear-gradient(135deg, #2d5a27, #4a8234);
        border: none;
        padding: 15px 40px;
        font-size: 18px;
        font-weight: 600;
        border-radius: 8px;
        transition: all 0.3s;
    }
    
    .btn-confirmar:hover {
        background: linear-gradient(135deg, #1a3009, #2d5016);
        transform: translateY(-3px);
        box-shadow: 0 8px 20px rgba(0,0,0,0.2);
    }
    
    .btn-volver {
        background: #fff;
        border: 2px solid #ddd;
        color: #666;
        padding: 15px 40px;
        font-size: 18px;
        font-weight: 600;
        border-radius: 8px;
        transition: all 0.3s;
    }
    
    .btn-volver:hover {
        border-color: #999;
        color: #333;
        background: #f5f5f5;
    }
    
    .acciones-confirmacion {
        display: flex;
        justify-content: center;
        gap: 20px;
        margin-top: 30px;
    }
</style>
{% endblock %}

{% block content %}
<div class="confirmacion-container">
    <div class="container">
        <div class="confirmacion-card card">
            <!-- Header -->
            <div class="card-header">
                <i class="fas fa-check-circle"></i>
                <h2 class="mb-0">¿Confirmar Registro de Parcela?</h2>
                <p class="mb-0 mt-2">Por favor revise cuidadosamente los datos antes de confirmar</p>
            </div>
            
            <!-- Body -->
            <div class="card-body p-4">
                
                <!-- Información del Cliente -->
                <div class="info-section">
                    <h4 class="mb-3">
                        <i class="fas fa-user-circle"></i> Información del Cliente
                    </h4>
                    <div class="dato-confirmacion">
                        <span class="dato-label">Cliente:</span>
                        <span class="dato-value">{{ invitacion.nombre_cliente }}</span>
                    </div>
                    {% if invitacion.email_cliente %}
                    <div class="dato-confirmacion">
                        <span class="dato-label">Email:</span>
                        <span class="dato-value">{{ invitacion.email_cliente }}</span>
                    </div>
                    {% endif %}
                    {% if invitacion.telefono_cliente %}
                    <div class="dato-confirmacion">
                        <span class="dato-label">Teléfono del Cliente:</span>
                        <span class="dato-value">{{ invitacion.telefono_cliente }}</span>
                    </div>
                    {% endif %}
                </div>
                
                <!-- Información de la Parcela -->
                <div class="info-section">
                    <h4 class="mb-3">
                        <i class="fas fa-map-marked-alt"></i> Datos de la Parcela
                    </h4>
                    <div class="dato-confirmacion">
                        <span class="dato-label">Nombre de la Parcela:</span>
                        <span class="dato-value">{{ nombre }}</span>
                    </div>
                    <div class="dato-confirmacion">
                        <span class="dato-label">Tipo de Cultivo:</span>
                        <span class="dato-value">{{ tipo_cultivo|default:"No especificado" }}</span>
                    </div>
                    {% if notas %}
                    <div class="dato-confirmacion">
                        <span class="dato-label">Notas:</span>
                        <span class="dato-value">{{ notas }}</span>
                    </div>
                    {% endif %}
                </div>
                
                <!-- Área Destacada -->
                <div class="area-destacada">
                    <i class="fas fa-chart-area" style="font-size: 40px; color: #2e7d32; margin-bottom: 10px;"></i>
                    <span class="numero">{{ area_hectareas }}</span>
                    <span class="label">hectáreas</span>
                </div>
                
                <!-- Advertencia -->
                <div class="advertencia-box">
                    <h5>
                        <i class="fas fa-exclamation-triangle"></i> 
                        Importante - Lea antes de confirmar
                    </h5>
                    <ul>
                        <li><strong>Verifique que todos los datos sean correctos</strong>, especialmente el área y los límites de la parcela.</li>
                        <li>Una vez confirmado, <strong>no podrá modificar la parcela</strong> por su cuenta.</li>
                        <li>El equipo de AgroTech se pondrá en contacto para iniciar el análisis satelital.</li>
                        <li>Recibirá una notificación cuando el análisis esté listo.</li>
                    </ul>
                </div>
                
                <!-- Formulario oculto para reenviar -->
                <form method="post" id="form-confirmacion">
                    {% csrf_token %}
                    <input type="hidden" name="nombre" value="{{ nombre }}">
                    <input type="hidden" name="tipo_cultivo" value="{{ tipo_cultivo }}">
                    <input type="hidden" name="geometria" value="{{ geometria_json }}">
                    <input type="hidden" name="notas" value="{{ notas }}">
                    <input type="hidden" name="telefono_contacto" value="{{ telefono_contacto }}">
                    <input type="hidden" name="confirmacion_final" value="true">
                    
                    <!-- Botones de acción -->
                    <div class="acciones-confirmacion">
                        <button type="button" class="btn btn-volver" onclick="history.back()">
                            <i class="fas fa-arrow-left"></i> Volver a Editar
                        </button>
                        <button type="submit" class="btn btn-confirmar">
                            <i class="fas fa-check-double"></i> Confirmar y Crear Parcela
                        </button>
                    </div>
                </form>
                
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
    // Prevenir doble envío
    const form = document.getElementById('form-confirmacion');
    let enviando = false;
    
    form.addEventListener('submit', function(e) {
        if (enviando) {
            e.preventDefault();
            return false;
        }
        
        enviando = true;
        
        // Deshabilitar botón y mostrar loading
        const btnConfirmar = form.querySelector('.btn-confirmar');
        btnConfirmar.disabled = true;
        btnConfirmar.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Creando parcela...';
    });
</script>
{% endblock %}
